# -*- encoding:utf-8 -*-
from mako import runtime, filters, cache
UNDEFINED = runtime.UNDEFINED
__M_dict_builtin = dict
__M_locals_builtin = locals
_magic_number = 6
_modified_time = 1333679410.796
_template_filename=u'F:/eclipsWorkSpace/pylibrary/tmpl/borrow/giveback_1.html'
_template_uri=u'giveback_1.html'
_template_cache=cache.Cache(__name__, _modified_time)
_source_encoding='utf-8'
_exports = []


def render_body(context,**pageargs):
    context.caller_stack._push_frame()
    try:
        __M_locals = __M_dict_builtin(pageargs=pageargs)
        __M_writer = context.writer()
        # SOURCE LINE 1
        __M_writer(u'<div class="table-wrapper">\r\n    <table id="borrhis_table" width="100%">\r\n        <thead>\r\n            <tr>\r\n                <th class="table-header light">\r\n                    bookinsid\r\n                </th>\r\n                <th class="table-header light">\r\n                    bookname\r\n                </th>\r\n                <th class="table-header light">\r\n                    auth\r\n                </th>\r\n                <th class="table-header light">\r\n                    readercardno\r\n                </th>\r\n                <th class="table-header light">\r\n                    readername\r\n                </th>\r\n                <th class="table-header light">\r\n                    orgcd_r\r\n                </th>\r\n                <th class="table-header light">\r\n                    borrdt\r\n                </th>\r\n                <th class="table-header light">\r\n                    borrexpdt\r\n                </th>\r\n                <th class="table-header light">\r\n                    overdays\r\n                </th>\r\n                <th class="table-header light">\r\n                    typover\r\n                </th>\r\n                <th class="table-header light">\r\n                    overprice\r\n                </th>\r\n                <th class="table-header light">\r\n                    \u652f\u4ed8\r\n                </th>\r\n                <th class="table-header light">\r\n                    op1\r\n                </th>\r\n            </tr>\r\n        </thead>\r\n        <tbody>\r\n        </tbody>\r\n    </table>\r\n    <div class="summary">\r\n        <strong>\u8d85\u671f\u73b0\u91d1\u5408\u8ba1:<label style="color: #DE564B;" id="sum_cash">\uffe50.00</label></strong>\r\n        <strong>\u8d85\u671f\u8bb0\u8d26\u5408\u8ba1:<label style="color: #DE564B;" id="sum_acc">\uffe50.00</label></strong>\r\n        <strong>\u8d85\u671f\u603b\u5408\u8ba1:<label style="color: #DE564B;" id="sum_overprice">\uffe50.00</label></strong></div>\r\n</div>\r\n<div id="deface_dialog" style="display: none">\r\n    <label for="defaceprice" style="margin: 5px 5px 0px 5px">\r\n        \u6c61\u635f\u7f5a\u91d1:</label>\r\n    <input type="text" id="defaceprice" name="defaceprice" style="width: 200px; margin: 5px 5px 0px 5px"\r\n        value="0.00" /><br />\r\n    <label for="defacenote" style="margin: 5px 5px -5px 5px">\r\n        \u6c61\u635f\u5907\u6ce8:</label>\r\n    <textarea cols="20" rows="3" id="defacenote" name="defacenote" style="width: 202px;\r\n        margin: 5px 5px -2px 5px"></textarea><br />\r\n</div>\r\n<script language="javascript" type="text/javascript">\r\n\r\n    $(document).ready(function () {\r\n        var sum_overprice = 0;\r\n        var sum_cash = 0;\r\n        var sum_acc = 0;\r\n\r\n        function addRow(borrhis) {\r\n            var tr = document.createElement("tr");\r\n            tr.id = "tr_" + borrhis.borrhisid;\r\n            tr.className = "table-row";\r\n            bindTr(tr, borrhis);\r\n\r\n            if (borrhis.overprice > 0) {\r\n                var td_overdue = document.createElement("td");\r\n                $(td_overdue).html(" ");\r\n                tr.appendChild(td_overdue);\r\n\r\n                render_overdue(borrhis, td_overdue);\r\n            }\r\n            else {\r\n                tr.appendChild(complib.createTdText(""));\r\n            }\r\n\r\n            var td_deface = complib.createTdBtn("btn_deface_" + borrhis.borrhisid, "\u6c61\u635f", function () {\r\n                render_deface(borrhis, td_deface);\r\n            });\r\n            $(td_deface).addClass("center");\r\n            tr.appendChild(td_deface);\r\n\r\n\r\n            $("#borrhis_table tbody").append(tr);\r\n        }\r\n\r\n        function bindTr(tr, borrhis) {\r\n            var f = complib.floatFormat;\r\n            var s = complib.stringFormat;\r\n            var b = complib.boolFormat;\r\n            var d = complib.dateFormat;\r\n            var m = complib.moneyFormat;\r\n            var v_overdays = function (obj) {return obj.overdays <= 0;};\r\n         \r\n            var descs = [\r\n                { bookinsid: [s, null, null] }, { bookname: [s, null, null] }, { auth: [s, null, null] },\r\n                { readercardno: [s, null, null] }, { readername: [s, null, null] }, { orgcd_r: [s, null, null] },\r\n                { borrdt: [d, null, null] }, { borrexpdt: [d, null, v_overdays] }, { overdays: [s, "right", v_overdays] },\r\n                { typoverprice: [m, "right", null] }, { overprice: [m, "right", v_overdays] }\r\n            ];\r\n            complib.appendTdArr(tr, borrhis, "borrhisid", descs);\r\n        }\r\n\r\n        function render_overdue(borrhis, td_overdue) {\r\n            var submit = function (v, h, f) {\r\n                if (v == true) {\r\n                    $(td_overdue).html("\u73b0\u91d1");\r\n                    sum_cash += borrhis.overprice;\r\n                    sum_overprice += borrhis.overprice;\r\n                    $("#sum_cash").html(complib.moneyFormat(sum_cash));\r\n                    $("#sum_overprice").html(complib.moneyFormat(sum_overprice));\r\n                }\r\n                else {\r\n                    $(td_overdue).html("\u8bb0\u8d26");\r\n                    sum_acc += borrhis.overprice;\r\n                    sum_overprice += borrhis.overprice;\r\n                    $("#sum_acc").html(complib.moneyFormat(sum_acc));\r\n                    $("#sum_overprice").html(complib.moneyFormat(sum_overprice));\r\n                }\r\n                complib.xhr("/borrow/giveback", \'POST\',\r\n                { act: \'overdue\', borrhisid: borrhis.borrhisid, paycd: v ? "CASH" : "ACC",\r\n                    readername: borrhis.readername, bookclsid: borrhis.bookclsid, bookname: borrhis.bookname\r\n                });\r\n                return true;\r\n            };\r\n\r\n            $.jBox.confirm("\u8bf7\u9009\u62e9\u7f5a\u6b3e\u652f\u4ed8\u65b9\u5f0f\uff1f", "\u8d85\u671f\u7f5a\u6b3e", submit, { buttons: { \'\u73b0\u91d1\': true, \'\u8bb0\u8d26\': false }, closed: function () {\r\n                $(\'#search_bookinsid\').focus();\r\n            }\r\n            });\r\n            $("a.jbox-close").hide();\r\n        }\r\n\r\n        function render_deface(borrhis, td_deface) {\r\n            var submit = function (v, h, f) {\r\n                var defaceprice = parseFloat(f.defaceprice)\r\n                if (isNaN(defaceprice) || defaceprice < 0) {\r\n                    return false;\r\n                }\r\n                complib.xhr("/borrow/giveback", \'POST\',\r\n                { act: \'deface\', borrhisid: borrhis.borrhisid, price: defaceprice, paycd: v, note: f.defacenote,\r\n                    readername: borrhis.readername, bookclsid: borrhis.bookclsid, bookname: borrhis.bookname\r\n                });\r\n                complib.chgTdStatus(td_deface, "ok");\r\n                return true;\r\n            };\r\n\r\n            $.jBox.open(\'id:deface_dialog\', "\u6c61\u635f\u5904\u7406", 300, 160, { submit: submit, buttons: { \'\u73b0\u91d1\': "CASH", \'\u8bb0\u8d26\': "ACC"} });\r\n        }\r\n\r\n        window.addRow = addRow;\r\n    });\r\n</script>\r\n')
        return ''
    finally:
        context.caller_stack._pop_frame()


