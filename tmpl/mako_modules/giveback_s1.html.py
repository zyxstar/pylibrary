# -*- encoding:utf-8 -*-
from mako import runtime, filters, cache
UNDEFINED = runtime.UNDEFINED
__M_dict_builtin = dict
__M_locals_builtin = locals
_magic_number = 6
_modified_time = 1332922925.6400001
_template_filename=u'F:/eclipsWorkSpace/pylibrary/tmpl/borrow/giveback_s1.html'
_template_uri=u'giveback_s1.html'
_template_cache=cache.Cache(__name__, _modified_time)
_source_encoding='utf-8'
_exports = []


def render_body(context,**pageargs):
    context.caller_stack._push_frame()
    try:
        __M_locals = __M_dict_builtin(pageargs=pageargs)
        __M_writer = context.writer()
        # SOURCE LINE 1
        __M_writer(u'<div class="table-wrapper">\r\n    <table id="borrhis_table" width="100%">\r\n        <thead>\r\n            <tr>\r\n                <th class="table-header light">\r\n                    bookname\r\n                </th>\r\n                <th class="table-header light">\r\n                    auth\r\n                </th>\r\n                <th class="table-header light">\r\n                    pub\r\n                </th>\r\n                <th class="table-header light">\r\n                    readercardno\r\n                </th>\r\n                <th class="table-header light">\r\n                    readername\r\n                </th>\r\n                <th class="table-header light">\r\n                    orgcd_r\r\n                </th>\r\n                <th class="table-header light">\r\n                    borrdt\r\n                </th>\r\n                <th class="table-header light">\r\n                    borrexpdt\r\n                </th>\r\n                <th class="table-header light">\r\n                    overdays\r\n                </th>\r\n                <th class="table-header light">\r\n                    overprice\r\n                </th>\r\n                <th class="table-header light">\r\n                    \u652f\u4ed8\r\n                </th>\r\n                <th class="table-header light">\r\n                    op2\r\n                </th>\r\n            </tr>\r\n        </thead>\r\n        <tbody>\r\n        </tbody>\r\n    </table>\r\n    <div class="summary">\r\n        \u73b0\u91d1\u5408\u8ba1:<label id="sum_cash">\uffe50.00</label>\u8bb0\u8d26\u5408\u8ba1:<label id="sum_acc">\uffe50.00</label>\u603b\u5408\u8ba1:<label\r\n            id="sum_overprice">\uffe50.00</label></div>\r\n</div>\r\n<div class="center">\r\n    <input type="button" id="btn_fresh" class="btn big" value="\u5b8c\u6210" /><br />\r\n</div>\r\n<div id="deface" style="display: none">\r\n    <label for="defaceprice" style="margin: 5px 5px 0px 5px">\r\n        \u6c61\u635f\u7f5a\u91d1:</label>\r\n    <input type="text" id="defaceprice" name="defaceprice" style="width: 200px; margin: 5px 5px 0px 5px"\r\n        value="0.00" /><br />\r\n    <label for="defacenote" style="margin: 5px 5px -5px 5px">\r\n        \u6c61\u635f\u5907\u6ce8:</label>\r\n    <textarea cols="20" rows="3" id="defacenote" name="defacenote" style="width: 202px;\r\n        margin: 5px 5px -2px 5px"></textarea><br />\r\n</div>\r\n<script language="javascript">\r\n    var sum_overprice = 0;\r\n    var sum_cash = 0;\r\n    var sum_acc = 0;\r\n\r\n    function addRow(borrhis) {\r\n        var tr = document.createElement("tr");\r\n        tr.id = "tr_" + borrhis.borrhisid;\r\n        tr.className = "table-row";\r\n        bindTr(tr, borrhis);\r\n\r\n        if (borrhis.overprice > 0) {\r\n            $(tr).addClass("warn");\r\n            var td_overdue = document.createElement("td");\r\n            $(td_overdue).html(" ");\r\n            tr.appendChild(td_overdue);\r\n\r\n            render_pay_overdue(borrhis, td_overdue);\r\n        }\r\n        else {\r\n            tr.appendChild(complib.createTdText(""));\r\n        }\r\n\r\n        var td_deface = document.createElement("td");\r\n        var btn = complib.createBtnNode("btn_deface_" + borrhis.borrhisid, "\u6c61\u635f", function () {\r\n            render_pay_deface(borrhis, td_deface);\r\n        });\r\n        td_deface.appendChild(btn);\r\n        tr.appendChild(td_deface);\r\n        $("#borrhis_table tbody").append(tr);\r\n    }\r\n\r\n    function bindTr(tr, borrhis) {\r\n        var f = complib.floatFormat;\r\n        var s = complib.stringFormat;\r\n        var b = complib.boolFormat;\r\n        var d = complib.dateFormat;\r\n        var m = complib.moneyFormat;\r\n        var attrs = [\r\n            { bookname: s }, { auth: s }, { pubcd_r: s },\r\n            { readercardno: s }, { readername: s }, { orgcd_r: s },\r\n            { borrdt: d }, { borrexpdt: d }, { overdays: s },\r\n            { overprice: m }\r\n        ];\r\n        complib.appendTdArr(tr, borrhis, attrs);\r\n    }\r\n\r\n    function render_pay_overdue(borrhis, td_overdue) {\r\n        var submit = function (v, h, f) {\r\n            if (v == true) {\r\n                $(td_overdue).html("\u73b0\u91d1");\r\n                sum_cash += borrhis.overprice;\r\n                sum_overprice += borrhis.overprice;\r\n                $("#sum_cash").html(complib.moneyFormat(sum_cash));\r\n                $("#sum_overprice").html(complib.moneyFormat(sum_overprice));\r\n            }\r\n            else {\r\n                $(td_overdue).html("\u8bb0\u8d26");\r\n                sum_acc += borrhis.overprice;\r\n                sum_overprice += borrhis.overprice;\r\n                $("#sum_acc").html(complib.moneyFormat(sum_acc));\r\n                $("#sum_overprice").html(complib.moneyFormat(sum_overprice));\r\n            }\r\n            complib.xhr("/borrow/giveback", \'POST\', { act: \'overdue\', borrhisid: borrhis.borrhisid, paycd: v ? "CASH" : "ACC" });\r\n            return true;\r\n        };\r\n\r\n        $.jBox.confirm("\u8bf7\u9009\u62e9\u7f5a\u6b3e\u652f\u4ed8\u65b9\u5f0f\uff1f", "\u8d85\u671f\u7f5a\u6b3e", submit, { buttons: { \'\u73b0\u91d1\': true, \'\u8bb0\u8d26\': false }, closed: function () {\r\n            $(\'#search_bookinsid\').focus();\r\n        }\r\n        });\r\n        $("a.jbox-close").hide();\r\n    }\r\n\r\n    function render_pay_deface(borrhis, td_deface) {\r\n        var submit = function (v, h, f) {\r\n            var defaceprice = parseFloat(f.defaceprice)\r\n            if (isNaN(defaceprice) || defaceprice < 0) {\r\n                return false;\r\n            }\r\n            complib.xhr("/borrow/giveback", \'POST\', { act: \'deface\', borrhisid: borrhis.borrhisid, price: defaceprice, paycd: v, note: f.defacenote });\r\n            $(td_deface).html(" ");\r\n            return true;\r\n        };\r\n\r\n        $.jBox.open(\'id:deface\', "\u6c61\u635f\u5904\u7406", 300, 150, { submit: submit, buttons: { \'\u73b0\u91d1\': "CASH", \'\u8bb0\u8d26\': "ACC"} });\r\n    }\r\n</script>\r\n')
        return ''
    finally:
        context.caller_stack._pop_frame()


